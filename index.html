<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Portofolio Generator</title>
    <link rel="stylesheet" href="style.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link rel="icon" type="image/png" href="assets/logo.png">
    <script src="https://cdn.jsdelivr.net/npm/pizzip@3.1.5/dist/pizzip.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/docxtemplater/3.39.0/docxtemplater.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.4.1/papaparse.min.js"></script>
</head>
<body>
    <div id="sidebar">
        <div id="sidebarToggle" onclick="toggleSidebar()">&#x25B6;</div>
        <div class="tab-button" onclick="switchTab('home')">Home</div>
        <div class="tab-button" onclick="switchTab('rekap')">Rekap</div>
        <div class="tab-button" onclick="switchTab('mahasiswa')">Mahasiswa</div>
        <div class="tab-button dropdown" onclick="toggleDropdown(event)">
            Time Series ‚ñº
            <div class="dropdown-content hidden">
                <div class="sub-tab-button" onclick="switchTab('timeprodi')">Prodi</div>
                <div class="sub-tab-button" onclick="switchTab('timemk')">Mata Kuliah</div>
            </div>
        </div>
    </div>

    <div id="mainContent">
        <div id="homeTab" class="tab-content active">

            <img src="assets/logo2.png" alt="Logo" class="logo-img">
            <h1 class="title">PORTOFOLIO GENERATOR</h1>
            <h2 class="subtitle">Version 0.1 - 25 Juli 2025</h2>

            <p class="description">
                Website ini ditujukan untuk memudahkan dosen Departemen Teknik Geodesi FT UGM dalam pembuatan Portofolio Mata Kuliah
            </p>
            <p>
                Link template RPKPS (New): <a href="https://drive.google.com/drive/folders/1ag3HJs5qA8oxGiXChU3iXuPaPKibbWd8?usp=sharing">Template RPKPS (New)</a><br>
                Link RPKPS setiap mata kuliah: <a href="https://docs.google.com/spreadsheets/d/1k0fT4Xq_DxciS0LIzynbmjU6bwp4LM0V_L5bD917yBo/edit?usp=sharing">Basisdata RPKPS</a><br>
                Link Peta Kurikulum: <a href="https://docs.google.com/spreadsheets/d/1bGLwJS37uzSJFAzyYarP0eGzbNK8EkoO/edit?usp=sharing&ouid=115539750102645325103&rtpof=true&sd=true">Peta Kurikulum</a>
            </p>

            <div class="input-group">
                <label for="searchMK"><strong>Cari Mata Kuliah:</strong></label>
                <div class="search-container">
                <input type="text" id="searchMK" placeholder="Cari mata kuliah..." oninput="filterMK()" autocomplete="off">
                <span class="search-icon">üîç</span>
                <div id="mkSuggestions" class="suggestions-box"></div>
                </div>
            </div>

            <div class="input-row">
                <div class="input-group">
                    <label for="kelas">Pilih Kelas:</label>
                    <select id="kelas">
                    <option value="A">A</option>
                    <option value="B">B</option>
                    <option value="C">C</option>
                    <option value="IUP">IUP</option>
                    </select>
                </div>

                <div class="input-group">
                    <label for="tahun">Pilih Tahun-Semester:</label>
                    <select id="tahun">
                    <option value="2024-1">2024-1</option>
                    <option value="2024-2">2024-2</option>
                    <option value="2025-1">2025-1</option>
                    <option value="2025-2">2025-2</option>
                    </select>
                </div>
            </div>

            <div class="input-group">
                <label>Berapa jumlah CPMK?</label>
                <input type="number" id="jumlahCPMK" min="1">
            </div>

            <div class="input-group">
                <label>CPL MK:</label>
                <div id="cplButtons" class="cpl-buttons">
                </div>
            </div>

            <div class="input-group">
                <div class="assessment-header-controls">
                    <label><strong>Rencana Asesmen:</strong></label>
                    <button onclick="addAssessmentRow()">+</button>
                    <button onclick="removeAssessmentRow()">-</button>
                </div>

                <div id="assessmentTable">
                    <div id="assessmentHeader">
                    <div>CPMK</div>
                    <div>Tipe</div>
                    <div>Deskripsi</div>
                    <div>Persentase</div>
                    <div>Nilai Maksimal</div>
                    <div>CPL</div>
                    <div>PI</div>
                    </div>

                    <div id="assessmentRows"></div>
                    <p id="persentaseWarning"></p>
                </div>
            </div>

            <div class="button-group">
                <button class="main-button" onclick="saveTemplate()">Save as Template</button>
                <label for="templateUpload" class="main-button">Load Template</label>
                <input type="file" id="templateUpload" accept=".csv" style="display:none" onchange="loadTemplate(event)">
            </div>

            <div class="input-group">
                <label>Berapa jumlah mahasiswa?</label>
                <input type="number" id="jumlahMahasiswa" min="1">
            </div>

            <div class="button-group">
                <button class="main-button" onclick="generateCSVTemplate()">Generate Template CSV</button>
                <label for="csvUpload" class="main-button">Upload Nilai</label>
                <input type="file" id="csvUpload" accept=".csv" style="display: none;" />
                <button class="main-button" onclick="generateCPMKPortfolio()">Generate Portofolio</button>
            </div>
            <div id="uploadStatus" style="margin-top: 10px;"></div>
            
            <div id="cpmkPerformance"></div>
            <canvas id="cpmkChart" width="600" height="300"></canvas>
            <div id="cplPerformance"></div>
            <canvas id="cplChart" width="600" height="300"></canvas>
            <div id="piPerformance"></div>
            <canvas id="piChart" width="600" height="300"></canvas>

            <div class="input-group">
                <label for="evaluasi">Evaluasi Hasil Pembelajaran:</label>
                <textarea id="evaluasi" rows="5" placeholder="Tulis evaluasi di sini..."></textarea><br>

                <label for="rencana">Rencana Pengembangan:</label>
                <textarea id="rencana" rows="5" placeholder="Tulis rencana pengembangan di sini..."></textarea>
            </div>

            <div class="button-group">
                <button class="main-button" onclick="generateAndDownloadFullPortfolio()">Download Portofolio</button>
                <button class="main-button" onclick="sendToSheet()">Kirim Nilai MK</button>
                <button class="main-button" onclick="sendMahasiswaNilai()">Kirim Nilai Mahasiswa</button>
            </div>

        </div>

        <div id="rekapTab" class="tab-content">
            <h2>Rekapitulasi Capaian Portofolio</h2>

            <div class="input-group">
                <label for="filterYear">Pilih Tahun:</label>
                <select id="filterYear">
                    <option value="2024">2024</option>
                    <option value="2025">2025</option>
                    <!-- More options can be added here -->
                </select>
            </div>
            <div class="input-group" style="align-self: flex-end;">
                <button class="main-button" onclick="filterRekapByYear()">Show Portofolio</button>
            </div>

            <div id="rekapContent" style="display:none;">
                <h3>Rekapitulasi Capaian CPL</h3>
                <canvas id="soRadarChart" width="400" height="400"></canvas>
                <div id="cplTableContainer" class="table-container"></div>

                <h3>Rekapitulasi Capaian PI</h3>
                <canvas id="rekapPiChart" width="800" height="400"></canvas>
                <div id="piTableContainer" class="table-container"></div>
            </div>
        </div>

        <div id="mahasiswaTab" class="tab-content">
            <h2>Portofolio Mahasiswa</h2>
            <div class="input-group">
            <label for="searchNIM"><strong>Cari Mahasiswa (NIM):</strong></label>
            <div class="search-container">
                <input type="text" id="searchNIM" placeholder="Cari NIM mahasiswa..." oninput="filterMahasiswa()" autocomplete="off">
                <span class="search-icon">üîç</span>
                <div id="nimSuggestions" class="suggestions-box"></div>
            </div>
            <button class="main-button" onclick="loadStudentPortfolio()">Tampilkan Portofolio</button>
            </div>

            <div id="studentCourses"></div>
            <h3>Nilai CPL</h3>
            <canvas id="studentCPLChart" style="max-width: 100%; margin-top: 30px;"></canvas>
            <div id="studentCPLTable" style="margin-top: 20px;"></div>
            <h3>Nilai PI</h3>
            <canvas id="studentPiChart" style="max-width: 100%; margin-top: 30px;"></canvas>
            <div id="studentPiTable" style="margin-top: 20px;"></div>
        </div>

        <!-- Time Series - Prodi -->
        <div id="timeprodiTab" class="tab-content">
            <h2>Time-Series CPL Prodi</h2>
            <div class="input-row">
                <div class="input-group">
                <label for="tahunAwalProdi">Dari Tahun:</label>
                <select id="tahunAwalProdi">
                    <option value="2024">2024</option>
                    <option value="2025">2025</option>
                    <!-- Add more as needed -->
                </select>
                </div>
                <div class="input-group">
                <label for="tahunAkhirProdi">Ke Tahun:</label>
                <select id="tahunAkhirProdi">
                    <option value="2024">2024</option>
                    <option value="2025">2025</option>
                </select>
                </div>
            </div>
            <button class="main-button" onclick="loadTimeProdiPortfolio()">Tampilkan Portofolio</button>
            <div id="prodiChartContainer" style="max-width: 100%; margin-top: 30px;"></div>
        </div>

        <!-- Time Series - Mata Kuliah -->
        <div id="timemkTab" class="tab-content">
            <h2>Time-Series CPL Mata Kuliah</h2>

            <div class="input-group">
                <label for="pilihMKTS"><strong>Pilih Mata Kuliah:</strong></label>
                <div class="search-container">
                    <input
                    type="text"
                    id="pilihMKTS"
                    placeholder="Cari mata kuliah..."
                    oninput="filterMK_TS()"
                    autocomplete="off"
                    />
                    <span class="search-icon">üîç</span>
                    <div id="mkSuggestionsTS" class="suggestions-box"></div>
                </div>
            </div>

            <div class="input-row">
                <div class="input-group">
                <label for="tahunAwalMK">Dari Tahun:</label>
                <select id="tahunAwalMK">
                    <option value="2024">2024</option>
                    <option value="2025">2025</option>
                </select>
                </div>
                <div class="input-group">
                <label for="tahunAkhirMK">Ke Tahun:</label>
                <select id="tahunAkhirMK">
                    <option value="2024">2024</option>
                    <option value="2025">2025</option>
                </select>
                </div>
            </div>
            <button class="main-button" onclick="loadTimeMKPortfolio()">Tampilkan Portofolio</button>
            <div id="mkChartContainer" style="max-width: 100%; margin-top: 30px;"></div>
        </div>
    </div>

    <div id="loadingOverlay">
        <div class="spinner"></div>
    </div>

    <script src="main.js"></script>
</body>
</html>